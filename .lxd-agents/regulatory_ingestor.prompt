{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "urn:lxd:compliance:eu-ai-act:article12:record-keeping:v1.0.0",
  "title": "LXD Advisory — EU AI Act Article 12 Record-Keeping Schema",
  "description": "AWS Lambda transformation layer schema for S3-based audit trail compliance with EU AI Act Article 12 (Logging & Record-Keeping obligations for high-risk AI systems). Generated by LXD Advisory Technical Compliance Architect.",
  "type": "object",

  "x-lxd-meta": {
    "schema_version": "1.0.0",
    "regulatory_instrument": "Regulation (EU) 2024/1689 — EU Artificial Intelligence Act",
    "primary_articles": ["Article 12", "Article 9", "Article 17", "Annex IV"],
    "aws_target_service": "Amazon S3 (audit trail) via AWS Lambda transformation",
    "s3_prefix_convention": "audit-trail/eu-ai-act/art12/{system_id}/{YYYY}/{MM}/{DD}/",
    "retention_policy_years": 10,
    "architect": "LXD Advisory Technical Compliance Architect",
    "ambiguity_gap_count": 9,
    "last_updated": "2026-02-28"
  },

  "required": [
    "record_id",
    "schema_version",
    "event_timestamp",
    "ingestion_timestamp",
    "ai_system_identity",
    "deployment_context",
    "operational_event",
    "input_data_descriptor",
    "output_data_descriptor",
    "human_oversight",
    "risk_management_linkage",
    "data_governance",
    "technical_assumptions",
    "integrity_controls"
  ],

  "properties": {

    "record_id": {
      "type": "string",
      "format": "uuid",
      "description": "Universally unique identifier for this log record. Generated by Lambda at ingestion.",
      "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$",
      "regulatory_reference": "AI_Act_Art12_Para1 — logs must be uniquely identifiable and traceable",
      "x-aws": { "generated_by": "Lambda@ingestion", "immutable": true }
    },

    "schema_version": {
      "type": "string",
      "const": "1.0.0",
      "description": "Version of this record-keeping schema. Required for forward-compatibility of S3 audit queries.",
      "regulatory_reference": "AI_Act_Art12_Para1 — audit trail must be interpretable over time",
      "x-ambiguity-gap": null
    },

    "event_timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 UTC timestamp of when the AI system event occurred (not when it was logged). Nanosecond precision preferred.",
      "example": "2026-02-28T14:32:00.000000Z",
      "regulatory_reference": "AI_Act_Art12_Para1_PointA — logs must record the period of use with date and time",
      "x-ambiguity-gap": {
        "gap_id": "AG-001",
        "issue": "Article 12 specifies 'date and time' but does not define required precision (seconds vs. milliseconds vs. nanoseconds).",
        "lxd_assumption": "UTC ISO 8601 with millisecond precision minimum. Nanosecond recommended for high-frequency systems. Clock source must be AWS Time Sync Service (PTP)."
      }
    },

    "ingestion_timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 UTC timestamp of when the Lambda function wrote the record to S3. Allows delta analysis for latency auditing.",
      "regulatory_reference": "AI_Act_Art12_Para1 — implicit: audit trail integrity requires write-time provenance",
      "x-aws": { "generated_by": "Lambda@S3_write" }
    },

    "ai_system_identity": {
      "type": "object",
      "description": "Full identity fingerprint of the AI system producing this record.",
      "regulatory_reference": "AI_Act_Art12_Para1 — logs must be attributable to a specific AI system; Annex_IV_Point1",
      "required": ["system_id", "system_name", "version", "provider_name", "provider_eu_registration_id", "notified_body_reference", "risk_classification"],
      "properties": {
        "system_id": {
          "type": "string",
          "description": "Immutable UUID assigned at system registration. Must match EU AI Act database entry.",
          "regulatory_reference": "AI_Act_Art49 — registration in EU database; AI_Act_Art12_Para1",
          "x-aws": { "mapped_to": "S3 object tag: x-ai-system-id" }
        },
        "system_name": {
          "type": "string",
          "maxLength": 256,
          "regulatory_reference": "Annex_IV_Point1"
        },
        "version": {
          "type": "string",
          "description": "Semantic version of the AI model/system. Must reflect any post-market modification.",
          "regulatory_reference": "AI_Act_Art12_Para1_PointB — version used must be logged; AI_Act_Art16_PointH",
          "x-ambiguity-gap": {
            "gap_id": "AG-002",
            "issue": "Art 12 requires logging the 'version' but does not define whether this means model weights version, API version, pipeline version, or all three.",
            "lxd_assumption": "Capture all three as sub-fields: model_weights_version, api_version, pipeline_version. Use SemVer 2.0.0 format."
          }
        },
        "model_weights_version": { "type": "string", "regulatory_reference": "AI_Act_Art12_Para1_PointB" },
        "api_version": { "type": "string", "regulatory_reference": "AI_Act_Art12_Para1_PointB" },
        "pipeline_version": { "type": "string", "regulatory_reference": "AI_Act_Art12_Para1_PointB" },
        "provider_name": {
          "type": "string",
          "regulatory_reference": "Annex_IV_Point1; AI_Act_Art9"
        },
        "provider_eu_registration_id": {
          "type": "string",
          "description": "EU AI Act Article 49 database registration number.",
          "regulatory_reference": "AI_Act_Art49_Para1"
        },
        "notified_body_reference": {
          "type": ["string", "null"],
          "description": "Reference number of the Notified Body that issued conformity assessment, if applicable.",
          "regulatory_reference": "AI_Act_Art43; AI_Act_Art12_Para1"
        },
        "risk_classification": {
          "type": "string",
          "enum": ["HIGH_RISK", "LIMITED_RISK", "MINIMAL_RISK", "PROHIBITED"],
          "description": "Risk tier under EU AI Act Annex III classification.",
          "regulatory_reference": "AI_Act_AnnexIII; AI_Act_Art12_Para1 — Art 12 applies specifically to high-risk systems"
        },
        "annex_iii_category": {
          "type": ["string", "null"],
          "description": "Specific Annex III use-case category (e.g., 'Annex_III_Point1_Biometric', 'Annex_III_Point6_Employment').",
          "regulatory_reference": "AI_Act_AnnexIII"
        }
      }
    },

    "deployment_context": {
      "type": "object",
      "description": "Where and by whom the AI system is being operated.",
      "regulatory_reference": "AI_Act_Art12_Para1_PointA — geographic and operator context of use",
      "required": ["deployer_id", "deployer_name", "deployment_environment", "geographic_jurisdiction"],
      "properties": {
        "deployer_id": {
          "type": "string",
          "format": "uuid",
          "description": "UUID of the deployer entity (distinct from provider).",
          "regulatory_reference": "AI_Act_Art3_Point4 — definition of deployer; AI_Act_Art26"
        },
        "deployer_name": { "type": "string", "regulatory_reference": "AI_Act_Art26" },
        "deployment_environment": {
          "type": "string",
          "enum": ["PRODUCTION", "STAGING", "TESTING", "SANDBOX"],
          "regulatory_reference": "AI_Act_Art12_Para1 — record-keeping applies to actual use; TESTING/SANDBOX included for completeness"
        },
        "geographic_jurisdiction": {
          "type": "string",
          "description": "ISO 3166-1 alpha-2 country code or 'EU' for pan-EU deployments.",
          "pattern": "^([A-Z]{2}|EU)$",
          "regulatory_reference": "AI_Act_Art2 — territorial scope; AI_Act_Art12_Para1_PointA"
        },
        "aws_region": {
          "type": "string",
          "description": "AWS region where processing occurred. Required for data residency compliance under GDPR Art 44 when combined with EU AI Act.",
          "example": "eu-central-1",
          "regulatory_reference": "AI_Act_Art12_Para1 — implicit: processing location relevant to jurisdiction; GDPR_Art44"
        },
        "intended_purpose": {
          "type": "string",
          "maxLength": 1024,
          "description": "The specific intended purpose for which the AI system is deployed in this context, as per the instructions for use.",
          "regulatory_reference": "AI_Act_Art12_Para1_PointA; Annex_IV_Point2"
        }
      }
    },

    "operational_event": {
      "type": "object",
      "description": "Details of the specific AI system operation / inference event being logged.",
      "regulatory_reference": "AI_Act_Art12_Para1 — each use of the system must generate a log entry",
      "required": ["event_type", "session_id", "request_id", "duration_ms"],
      "properties": {
        "event_type": {
          "type": "string",
          "enum": [
            "INFERENCE_REQUEST",
            "BATCH_INFERENCE",
            "MODEL_UPDATE",
            "SYSTEM_OVERRIDE",
            "HUMAN_INTERVENTION",
            "AUTOMATED_DECISION",
            "ERROR_EVENT",
            "AUDIT_ACCESS"
          ],
          "regulatory_reference": "AI_Act_Art12_Para1 — type of operation must be identifiable"
        },
        "session_id": {
          "type": "string",
          "description": "Groups multiple requests within a single user/operator session.",
          "regulatory_reference": "AI_Act_Art12_Para1 — implicit: period of use requires session-level traceability"
        },
        "request_id": {
          "type": "string",
          "description": "Unique ID of this specific inference call. Maps to AWS API Gateway request ID if applicable.",
          "regulatory_reference": "AI_Act_Art12_Para1"
        },
        "duration_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "End-to-end processing duration in milliseconds.",
          "regulatory_reference": "AI_Act_Art12_Para1_PointA — implicit: temporal boundaries of each use",
          "x-ambiguity-gap": {
            "gap_id": "AG-003",
            "issue": "Art 12 references 'period of use' but does not clarify whether this means wall-clock time, CPU time, or inference time only.",
            "lxd_assumption": "Record wall-clock end-to-end latency in milliseconds from API gateway receipt to response dispatch."
          }
        },
        "is_automated_decision": {
          "type": "boolean",
          "description": "True if the output constitutes an automated decision with legal or similarly significant effects under GDPR Art 22.",
          "regulatory_reference": "AI_Act_Art12_Para1_PointD; GDPR_Art22"
        },
        "triggered_threshold_alert": {
          "type": "boolean",
          "description": "Whether this event triggered any risk threshold defined in the risk management system.",
          "regulatory_reference": "AI_Act_Art9_Para2; AI_Act_Art12_Para1"
        }
      }
    },

    "input_data_descriptor": {
      "type": "object",
      "description": "Metadata describing inputs fed to the AI system. Actual data must NOT be stored here — only descriptors, to balance Art 12 traceability with GDPR data minimisation.",
      "regulatory_reference": "AI_Act_Art12_Para1_PointC — input data that triggered the output must be logged",
      "required": ["input_reference_id", "input_data_categories", "data_subjects_count_estimate"],
      "properties": {
        "input_reference_id": {
          "type": "string",
          "description": "Pointer (S3 URI or hash) to the actual input payload, stored separately with appropriate access controls.",
          "regulatory_reference": "AI_Act_Art12_Para1_PointC",
          "x-aws": { "format": "s3://[bucket]/inputs/[hash]" }
        },
        "input_hash_sha256": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$",
          "description": "SHA-256 hash of the raw input payload for integrity verification without storing PII.",
          "regulatory_reference": "AI_Act_Art12_Para1_PointC; GDPR_Art5_Para1_PointC — data minimisation"
        },
        "input_data_categories": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "BIOMETRIC", "HEALTH", "FINANCIAL", "CRIMINAL_JUSTICE",
              "EMPLOYMENT", "EDUCATION", "DEMOGRAPHIC", "BEHAVIORAL",
              "LOCATION", "TEXT", "IMAGE", "AUDIO", "VIDEO",
              "STRUCTURED_NUMERIC", "OTHER"
            ]
          },
          "description": "GDPR Article 9 special category flags and general data type classification.",
          "regulatory_reference": "AI_Act_Art12_Para1_PointC; GDPR_Art9"
        },
        "contains_special_category_data": {
          "type": "boolean",
          "regulatory_reference": "GDPR_Art9; AI_Act_Art12_Para1_PointC"
        },
        "data_subjects_count_estimate": {
          "type": "integer",
          "minimum": 0,
          "description": "Estimated number of natural persons whose data was processed in this request.",
          "regulatory_reference": "AI_Act_Art12_Para1_PointC; GDPR_Art30",
          "x-ambiguity-gap": {
            "gap_id": "AG-004",
            "issue": "Art 12 requires logging input data but does not specify granularity — individual-level vs. batch-level. GDPR minimisation conflicts with full input logging.",
            "lxd_assumption": "Store SHA-256 hash of input + categorical metadata only. Actual PII inputs stored in separate S3 bucket with KMS encryption and stricter IAM policy. Record count is an estimate for batch jobs."
          }
        },
        "data_source_descriptor": {
          "type": "string",
          "description": "Human-readable description of the data source (e.g., 'hospital EHR system', 'credit bureau API'). No PII.",
          "regulatory_reference": "Annex_IV_Point3; AI_Act_Art12_Para1_PointC"
        }
      }
    },

    "output_data_descriptor": {
      "type": "object",
      "description": "Metadata about the AI system's output/decision.",
      "regulatory_reference": "AI_Act_Art12_Para1_PointD — outputs and decisions must be logged",
      "required": ["output_reference_id", "output_type", "confidence_score_available"],
      "properties": {
        "output_reference_id": {
          "type": "string",
          "description": "Pointer (S3 URI or hash) to the output payload.",
          "regulatory_reference": "AI_Act_Art12_Para1_PointD"
        },
        "output_hash_sha256": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$",
          "regulatory_reference": "AI_Act_Art12_Para1_PointD"
        },
        "output_type": {
          "type": "string",
          "enum": [
            "CLASSIFICATION", "REGRESSION_SCORE", "RECOMMENDATION",
            "RANKING", "NATURAL_LANGUAGE_TEXT", "IMAGE_GENERATION",
            "RISK_SCORE", "DECISION_BINARY", "ANOMALY_FLAG", "OTHER"
          ],
          "regulatory_reference": "AI_Act_Art12_Para1_PointD"
        },
        "confidence_score_available": {
          "type": "boolean",
          "description": "Whether the system produced a confidence/probability score alongside its output.",
          "regulatory_reference": "AI_Act_Art13_Para3_PointB — transparency; AI_Act_Art12_Para1_PointD",
          "x-ambiguity-gap": {
            "gap_id": "AG-005",
            "issue": "Art 12 does not explicitly require logging confidence scores, but Art 13 transparency requirements imply interpretability of outputs.",
            "lxd_assumption": "Log confidence score availability flag. Store actual score in output payload reference. Flag if score is below system-defined reliability threshold."
          }
        },
        "confidence_score": {
          "type": ["number", "null"],
          "minimum": 0.0,
          "maximum": 1.0,
          "regulatory_reference": "AI_Act_Art13_Para3_PointB"
        },
        "output_acted_upon": {
          "type": ["boolean", "null"],
          "description": "Whether a human operator confirmed the AI output was acted upon. Null if unknown at log time.",
          "regulatory_reference": "AI_Act_Art12_Para1_PointD; AI_Act_Art14_Para4 — human oversight"
        }
      }
    },

    "human_oversight": {
      "type": "object",
      "description": "Records the human-in-the-loop status for this event, as mandated for high-risk AI systems.",
      "regulatory_reference": "AI_Act_Art14 — human oversight; AI_Act_Art12_Para1_PointE",
      "required": ["oversight_mode", "human_review_occurred"],
      "properties": {
        "oversight_mode": {
          "type": "string",
          "enum": ["HUMAN_IN_THE_LOOP", "HUMAN_ON_THE_LOOP", "FULLY_AUTOMATED", "HUMAN_IN_COMMAND"],
          "regulatory_reference": "AI_Act_Art14_Para1; AI_Act_Art12_Para1_PointE"
        },
        "human_review_occurred": {
          "type": "boolean",
          "description": "Whether a human reviewed the AI output before it was acted upon.",
          "regulatory_reference": "AI_Act_Art14_Para4; AI_Act_Art12_Para1_PointE"
        },
        "reviewer_id": {
          "type": ["string", "null"],
          "description": "Pseudonymised identifier of the human reviewer. Must not store name directly.",
          "regulatory_reference": "AI_Act_Art14; GDPR_Art5_Para1_PointC — minimisation",
          "x-ambiguity-gap": {
            "gap_id": "AG-006",
            "issue": "Art 12 requires human oversight to be logged, but does not specify how to identify the human reviewer while complying with GDPR data minimisation.",
            "lxd_assumption": "Store pseudonymised reviewer_id (HMAC of employee ID with rotating key). Full identity mapping maintained in separate HR system with restricted access."
          }
        },
        "override_occurred": {
          "type": "boolean",
          "description": "Whether the human reviewer overrode the AI system's output.",
          "regulatory_reference": "AI_Act_Art14_Para4_PointD — ability to override; AI_Act_Art12_Para1_PointE"
        },
        "override_reason_code": {
          "type": ["string", "null"],
          "enum": ["ACCURACY_CONCERN", "ETHICAL_CONCERN", "POLICY_VIOLATION", "INSUFFICIENT_CONFIDENCE", "CONTEXTUAL_JUDGMENT", "OTHER", null],
          "regulatory_reference": "AI_Act_Art14_Para4_PointD; AI_Act_Art12_Para1_PointE"
        }
      }
    },

    "risk_management_linkage": {
      "type": "object",
      "description": "Links this record to the AI system's risk management framework, as required by Art 9.",
      "regulatory_reference": "AI_Act_Art9 — risk management system; AI_Act_Art12_Para1",
      "properties": {
        "risk_management_version": {
          "type": "string",
          "description": "Version of the risk management documentation in force at time of this event.",
          "regulatory_reference": "AI_Act_Art9_Para2; Annex_IV_Point5"
        },
        "active_risk_controls": {
          "type": "array",
          "items": { "type": "string" },
          "description": "List of risk control measure IDs active during this event.",
          "regulatory_reference": "AI_Act_Art9_Para4"
        },
        "conformity_assessment_reference": {
          "type": ["string", "null"],
          "description": "Reference to the conformity assessment certificate (Art 43) applicable to this system version.",
          "regulatory_reference": "AI_Act_Art43; AI_Act_Art12_Para1"
        },
        "post_market_monitoring_flag": {
          "type": "boolean",
          "description": "Whether this event has been flagged for post-market monitoring review.",
          "regulatory_reference": "AI_Act_Art72 — post-market monitoring; AI_Act_Art12_Para1"
        },
        "serious_incident_flag": {
          "type": "boolean",
          "description": "Whether this event constitutes or contributes to a 'serious incident' as defined in Art 3(49).",
          "regulatory_reference": "AI_Act_Art3_Point49; AI_Act_Art73 — serious incident reporting",
          "x-ambiguity-gap": {
            "gap_id": "AG-007",
            "issue": "Art 3(49) defines 'serious incident' but threshold for automated flagging is not technically specified.",
            "lxd_assumption": "Flag as serious_incident if: (a) output_acted_upon=true AND override_occurred=false AND a downstream harm signal is detected via webhook, OR (b) manually flagged by human reviewer. Automated harm detection is out-of-scope for this schema version."
          }
        }
      }
    },

    "data_governance": {
      "type": "object",
      "description": "GDPR and EU AI Act data governance metadata for this record itself.",
      "regulatory_reference": "AI_Act_Art12_Para2 — retention; GDPR_Art30; AI_Act_Art17",
      "required": ["retention_expiry_date", "legal_basis", "gdpr_lawful_basis"],
      "properties": {
        "retention_expiry_date": {
          "type": "string",
          "format": "date",
          "description": "Date after which this record must be deleted or archived per Art 12(2) — minimum 10 years for high-risk systems.",
          "regulatory_reference": "AI_Act_Art12_Para2 — retention period",
          "x-ambiguity-gap": {
            "gap_id": "AG-008",
            "issue": "Art 12(2) states records must be kept for a period 'appropriate to the intended purpose' with no fixed number for all categories. Recital 72 suggests at least 10 years for high-risk systems, but this is not black-letter law for all cases.",
            "lxd_assumption": "Apply 10-year retention for all Annex III high-risk systems as a conservative floor. S3 Lifecycle policy enforces transition to Glacier at 3 years, deletion at 10 years + 1 day."
          }
        },
        "legal_basis": {
          "type": "string",
          "enum": ["LEGAL_OBLIGATION_EU_AI_ACT", "LEGITIMATE_INTEREST", "CONTRACT", "CONSENT"],
          "description": "Legal basis for processing and retaining this record.",
          "regulatory_reference": "AI_Act_Art12_Para1; GDPR_Art6"
        },
        "gdpr_lawful_basis": {
          "type": "string",
          "enum": ["Art6_1a_Consent", "Art6_1b_Contract", "Art6_1c_LegalObligation", "Art6_1d_VitalInterests", "Art6_1e_PublicTask", "Art6_1f_LegitimateInterests"],
          "regulatory_reference": "GDPR_Art6; AI_Act_Art12_Para1"
        },
        "dpia_reference": {
          "type": ["string", "null"],
          "description": "Reference to the Data Protection Impact Assessment covering this AI system's processing.",
          "regulatory_reference": "GDPR_Art35; AI_Act_Art9"
        },
        "cross_border_transfer": {
          "type": "boolean",
          "description": "Whether data in this event was transferred outside the EEA.",
          "regulatory_reference": "GDPR_Art44; AI_Act_Art2"
        }
      }
    },

    "technical_assumptions": {
      "type": "object",
      "description": "Formally records all technical assumptions made by LXD Advisory to fill regulatory ambiguity gaps. This block is itself subject to audit.",
      "regulatory_reference": "AI_Act_Art12_Para1 — implicit: audit trail must be self-documenting",
      "properties": {
        "assumption_ids_applied": {
          "type": "array",
          "items": { "type": "string", "pattern": "^AG-[0-9]{3}$" },
          "description": "List of Ambiguity Gap IDs (AG-XXX) whose assumptions were applied in generating this record.",
          "example": ["AG-001", "AG-002", "AG-003"]
        },
        "clock_source": {
          "type": "string",
          "enum": ["AWS_TIME_SYNC_PTP", "NTP", "UNKNOWN"],
          "description": "Time synchronisation source used for event_timestamp. AG-001 assumption.",
          "regulatory_reference": "AI_Act_Art12_Para1_PointA"
        },
        "input_logging_mode": {
          "type": "string",
          "enum": ["HASH_ONLY", "CATEGORICAL_METADATA_ONLY", "FULL_PAYLOAD_ENCRYPTED", "REFERENCE_POINTER"],
          "description": "How input data was logged. AG-004 assumption applied.",
          "regulatory_reference": "AI_Act_Art12_Para1_PointC; GDPR_Art5_Para1_PointC"
        }
      }
    },

    "integrity_controls": {
      "type": "object",
      "description": "Cryptographic and access controls ensuring the immutability and authenticity of this audit record.",
      "regulatory_reference": "AI_Act_Art12_Para1 — logs must be tamper-evident; AI_Act_Art17",
      "required": ["record_hash_sha256", "lambda_function_arn", "s3_object_key"],
      "properties": {
        "record_hash_sha256": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$",
          "description": "SHA-256 hash of the entire record payload (excluding this field) for tamper detection.",
          "regulatory_reference": "AI_Act_Art12_Para1 — implicit: tamper-evident logs"
        },
        "lambda_function_arn": {
          "type": "string",
          "description": "ARN of the AWS Lambda function that produced this record. Enables provenance tracing.",
          "pattern": "^arn:aws:lambda:[a-z0-9-]+:[0-9]{12}:function:.+$",
          "regulatory_reference": "AI_Act_Art12_Para1; AI_Act_Art17"
        },
        "lambda_function_version": {
          "type": "string",
          "description": "Qualified version of the Lambda function (not $LATEST — pinned version required for audit).",
          "regulatory_reference": "AI_Act_Art12_Para1_PointB — version must be logged"
        },
        "s3_object_key": {
          "type": "string",
          "description": "Full S3 object key where this record is persisted.",
          "example": "audit-trail/eu-ai-act/art12/{system_id}/2026/02/28/{record_id}.json.gz",
          "regulatory_reference": "AI_Act_Art12_Para1"
        },
        "s3_bucket_name": {
          "type": "string",
          "regulatory_reference": "AI_Act_Art12_Para1"
        },
        "kms_key_id": {
          "type": "string",
          "description": "AWS KMS CMK ID used to encrypt this record at rest. Key must be EU-region and customer-managed.",
          "regulatory_reference": "AI_Act_Art12_Para1; GDPR_Art32 — security of processing"
        },
        "s3_object_lock_mode": {
          "type": "string",
          "enum": ["COMPLIANCE", "GOVERNANCE", "NONE"],
          "description": "S3 Object Lock mode. COMPLIANCE recommended for regulatory audit trails — prevents deletion even by root.",
          "regulatory_reference": "AI_Act_Art12_Para2 — records must be maintained for required retention period"
        },
        "s3_object_lock_retain_until": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "S3 Object Lock retain-until date. Must equal retention_expiry_date.",
          "regulatory_reference": "AI_Act_Art12_Para2"
        },
        "cloudtrail_event_id": {
          "type": ["string", "null"],
          "description": "AWS CloudTrail event ID for the S3 PutObject call, enabling independent audit of the logging act itself.",
          "regulatory_reference": "AI_Act_Art12_Para1 — the logging system itself must be auditable",
          "x-ambiguity-gap": {
            "gap_id": "AG-009",
            "issue": "Art 12 is silent on whether the act of logging must itself be logged (meta-audit). However, NIS2 and ISO 27001 alignment implies this.",
            "lxd_assumption": "Capture CloudTrail event ID for every S3 write. CloudTrail logs retained in separate S3 bucket with independent KMS key and S3 Object Lock COMPLIANCE mode."
          }
        }
      }
    }
  },

  "x-lxd-ambiguity-gap-register": {
    "description": "Consolidated register of all Regulatory Ambiguity Gaps identified during schema design. Each gap requires sign-off by Legal Counsel and DPO before production deployment.",
    "gaps": [
      {
        "gap_id": "AG-001",
        "article": "AI_Act_Art12_Para1_PointA",
        "issue": "Timestamp precision undefined — 'date and time' unspecified",
        "lxd_assumption": "UTC ISO 8601 millisecond precision; AWS PTP clock source",
        "risk_level": "LOW",
        "sign_off_required": ["Legal", "Engineering"]
      },
      {
        "gap_id": "AG-002",
        "article": "AI_Act_Art12_Para1_PointB",
        "issue": "'Version' scope undefined — model weights vs API vs pipeline",
        "lxd_assumption": "Capture all three versioning dimensions independently",
        "risk_level": "MEDIUM",
        "sign_off_required": ["Legal", "MLOps", "Engineering"]
      },
      {
        "gap_id": "AG-003",
        "article": "AI_Act_Art12_Para1_PointA",
        "issue": "'Period of use' granularity undefined — wall clock vs CPU time",
        "lxd_assumption": "Wall-clock end-to-end latency in milliseconds",
        "risk_level": "LOW",
        "sign_off_required": ["Engineering"]
      },
      {
        "gap_id": "AG-004",
        "article": "AI_Act_Art12_Para1_PointC",
        "issue": "Input data logging scope conflicts with GDPR Art 5 data minimisation",
        "lxd_assumption": "SHA-256 hash + categorical metadata only; full payload in separate encrypted bucket",
        "risk_level": "HIGH",
        "sign_off_required": ["DPO", "Legal", "CISO"]
      },
      {
        "gap_id": "AG-005",
        "article": "AI_Act_Art12_Para1_PointD + Art13",
        "issue": "Confidence scores not explicitly required by Art 12 but implied by Art 13",
        "lxd_assumption": "Log availability flag + score; flag sub-threshold scores",
        "risk_level": "LOW",
        "sign_off_required": ["Legal"]
      },
      {
        "gap_id": "AG-006",
        "article": "AI_Act_Art14 + AI_Act_Art12_Para1_PointE",
        "issue": "Human reviewer identity: logging obligation vs GDPR minimisation",
        "lxd_assumption": "Pseudonymised HMAC of employee ID with rotating key",
        "risk_level": "HIGH",
        "sign_off_required": ["DPO", "Legal", "HR"]
      },
      {
        "gap_id": "AG-007",
        "article": "AI_Act_Art3_Point49 + Art73",
        "issue": "Automated serious incident detection threshold not defined in Art 12",
        "lxd_assumption": "Downstream harm webhook + manual reviewer flag; no automated harm inference",
        "risk_level": "HIGH",
        "sign_off_required": ["Legal", "Risk", "Engineering"]
      },
      {
        "gap_id": "AG-008",
        "article": "AI_Act_Art12_Para2",
        "issue": "Retention period: 'appropriate period' undefined for all risk categories",
        "lxd_assumption": "10-year floor for all Annex III systems; S3 Lifecycle enforced",
        "risk_level": "MEDIUM",
        "sign_off_required": ["Legal", "DPO"]
      },
      {
        "gap_id": "AG-009",
        "article": "AI_Act_Art12_Para1 (meta-audit)",
        "issue": "Art 12 is silent on whether the logging act itself must be independently audited",
        "lxd_assumption": "CloudTrail captures every S3 PutObject in independent WORM bucket",
        "risk_level": "LOW",
        "sign_off_required": ["CISO", "Engineering"]
      }
    ]
  }
}
